<!DOCTYPE html>
<html lang="ja">

        <head>
                <meta charset="UTF-8">
                <title>Portfolio Site with Draggable Navigation</title>
                <style>
                        * {
                                margin: 0;
                                padding: 0;
                                box-sizing: border-box;
                        }

                        :root {
                                /* ライトモード色変数 */
                                --mc: #072f5e;        /* メインカラー（アクセント） */
                                --sc: #6bb6ff;        /* サブカラー（メインの薄い版） */
                                --ac: #ff6b6b;        /* アクセントカラー（強調色） */
                                --bc: #f5f5f5;        /* ベースカラー（背景） */
                                --tx: #333333;        /* テキストカラー */
                                --bk: #000000;        /* ブラック */
                                --wh: #ffffff;        /* ホワイト */
                                --gr: #ddd;        /* グレー（ボーダー） */
                                
                                /* 派生色 */
                                --bgColor: var(--wh);
                                --navBg: var(--wh);
                                --modelBg: var(--wh);
                                --borderColor: var(--gr);
                                --line: 1px solid var(--gr);
                                --rad: 12px;

                                --shadow: 0 2px 10px var(--gr);

                                --inline:40px;
                                --gap:20px;
                                --gapH:calc(var(--gap)/2);
                        }
                        
                        /* ダークモード */
                        [data-theme="dark"] {
                                --mc: #65b2ff;        /* メインカラー（明るいブルー） */
                                --sc: #4a90e2;        /* サブカラー（メインの濃い版） */
                                --ac: #ff8a8a;        /* アクセントカラー（明るい赤） */
                                --bc: #1a1a1a;        /* ベースカラー（ダーク背景） */
                                --tx: #ffffff;        /* テキストカラー（白） */
                                --bk: #000000;        /* ブラック（そのまま） */
                                --wh: #2a2a2a;        /* ホワイト（ダークモード用） */
                                --gr: #666;        /* グレー（ダークモード用ボーダー） */
                                
                                /* 派生色 */
                        }
                        
                        /* ダークモードでの吹き出し色調整 */
                        [data-theme="dark"] .nav_window::after {
                                border-top-color: var(--navBg);
                        }
                        
                        [data-theme="dark"] .speech_bubble::after {
                                border-right-color: var(--navBg);
                        }
                        .txwh{color: var(--wh);}

                        body {
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'Yu Gothic Medium', 'Meiryo', sans-serif;
                                background: var(--bgColor);
                                color: var(--tx);
                                overflow-x: hidden;
                                transition: background-color var(--tr) ease, color var(--tr) ease;
                                font-size: 16px;
                                line-height: 1.6;
                                font-weight: 400;
                        }
                        
                        /* ダークモード切り替え時のスムーズなトランジション */
                        * {
                                transition: background-color var(--tr) ease, color var(--tr) ease, border-color var(--tr) ease, box-shadow var(--tr) ease;
                        }
                        
                        /* 言語別の文字サイズ調整 */
                        [lang="ja"] {
                                font-size: 16px;
                                line-height: 1.6;
                        }
                        
                        [lang="en"] {
                                font-size: 16px;
                                line-height: 1.5;
                        }
                        
                        /* ヘッダー要素の統一 */
                        h1, h2, h3, h4, h5, h6 {
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'Yu Gothic Medium', 'Meiryo', sans-serif;
                                font-weight: 600;
                                line-height: 1.3;
                        }
                        
                        /* ナビゲーションリンクの統一 */
                        .navigation a {
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'Yu Gothic Medium', 'Meiryo', sans-serif;
                                font-weight: 500;
                                font-size: 16px;
                                line-height: 1.4;
                        }

                        .app_container {
                                display: grid;
                                height: 100vh;
                                transition: var(--tr) cubic-bezier(0.4, 0, 0.2, 1);
                        }

                        :root {
                                --navW: 420px;
                                --tr:.4s;
                                @media (max-width: 1440px){
                                        --navW: 300px;
                                    
                                }

                        }

                        /* レイアウトモード */
                        .app_container.right{
                                padding-inline: 0 var(--navW);
                        }
                        .app_container.center{
                                
                                padding-inline: 0;
                        }
                        .app_container {
                                /* grid-template-columns: var(--navW) 1fr; */
                                display: flex;
                                padding-inline: var(--navW) 0;
                                

                        }

                        /* .app_container.center {
                                grid-template-columns: 1fr var(--navW) 1fr;
                        }

                        .app_container.right {
                                grid-template-columns: 1fr var(--navW);
                        } */

                        /* メインコンテンツエリア */
                        .main_content {
                                padding: var(--inline);
                                overflow-y: auto;
                                flex: 1;
                                display: flex;
                                flex-wrap: wrap;
                                gap: var(--gap)  var(--navW);
                        }

                        .content_section:is(.center *){
                                width: calc(50% - var(--navW)/2);
                        }
                        .content_section {
                                width: 100%;

                                padding: 30px;
                                border-radius: var(--rad);
                                border: var(--line);
                                transition: all var(--tr) ease;
                        }

                        .content_section h1 {
                                color: var(--mc);
                                margin-bottom: var(--gap);
                                font-size: 2.5em;
                        }

                        .content_section h2 {
                                color: var(--mc);
                                margin-bottom: 15px;
                                font-size: 1.8em;
                        }

                        .content_section p {
                                line-height: 1.6;
                                margin-bottom: 15px;
                                font-size: 1.1em;
                        }

                        /* ナビゲーションセクション */
                        .nav_section {
                                padding: var(--inline);
                                /* transform: translateX(calc(-50vw)); */
                                position: absolute;
                                top: 0;left: 0%;
                                height: 100%;
                                display: flex;
                                flex-direction: column;
                                gap: var(--gap);
                                z-index: 100;
                                width: var(--navW);
                                box-shadow: var(--shadow);
                        }
                        .nav_section:is(.right *){
                                left: calc(100% - var(--navW));
                        }
                        .nav_section:is(.center *){
                                left: calc(50% - var(--navW)/2);
                        }
                        
                        /* ドラッグ可能エリア */
                        /* .nav_section:hover  .speech_bubble.hoverVisible{opacity: 1;} */
                        .nav_section:hover  .speech_bubble:not(.hoverVisible){opacity: 0;}
                        .nav_section:hover  .speech_bubble:is(.hoverVisible){opacity: 1;}
                        .nav_section:has(.nav_window:hover)  .speech_bubble:is(.hoverVisible){opacity: 0;}
                        .nav_section:has(.nav_window:hover)  .speech_bubble:not(.hoverVisible){opacity: 1;}
                        .drag_area {
                                position: absolute; 
                                top: 0;
                                left: 0;
                                right: 0;
                                bottom: 0;
                                z-index: 1;
                                cursor: move;

                        }
                        

                        .drag_hint {
                                font-size: 0.75em;
                                pointer-events: none;
                                
                        }

                        /* ナビゲーションウインドウ */
                        .nav_window {
                                flex: 0 0 65%;
                                padding: var(--inline);
                                background: var(--navBg);
                                position: relative;
                                z-index: 5;
                                border-radius: var(--rad);
                                border: var(--line);
                        }
                        
                        /* ナビゲーション下中央の吹き出し */
                        .nav_window::after {
                                content: "";
                                position: absolute;
                                top: 100%;
                                left: 50%;
                                transform: translate(-50%, -50%) rotate(45deg);
                                width: var(--inline);
                                height: var(--inline);
                                border-right: var(--line);
                                border-bottom: var(--line);
                                transform-origin: center;
                                z-index: 6;
                                background-color: var(--navBg);
                                transition: var(--tr);
                        }

                        .nav_content {
                                height: 100%;
                                display: flex;
                                flex-direction: column;
                                gap: var(--gap);
                        }

                        .navigation {
                                display: flex;
                                flex-direction: column;
                                gap: var(--gapH);
                                padding-block: var(--gapH);
                        }

                        .navigation a {
                                text-decoration: none;
                                color: var(--tx);
                                padding: var(--rad) 16px;
                                border-radius: 8px;
                                transition: all var(--tr) ease;
                                font-weight: 500;
                        }

                        .navigation a:hover {
                                background: var(--mc);
                                color: var(--wh);
                                transform: translateX(5px);
                        }

                        .controls {
                                display: flex;
                                gap: 10px;
                        }

                        .control_btn {
                                flex: 1;
                                padding: 10px;
                                border: none;
                                border-radius: 6px;
                                background: var(--mc);
                                cursor: pointer;
                                transition: all var(--tr) ease;
                        }

                        .control_btn:hover {
                                background: var(--mc);
                                transform: translateY(-2px);
                        }

                        /* 3Dモデルエリア */
                        .model_container {
                                flex: 0 0 35%;
                                position: relative;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                overflow: hidden;
                        }

                        #threeCanvas {
                                width: 100%;
                                height: 100%;
                                display: block;
                        }

                        /* 吹き出しエフェクト */
                        .speech_bubble.hoverVisible{
                                opacity: 0;
                                font-size: 2em;
                                z-index: 10;
                                writing-mode: horizontal-tb;
                        }
                        .speech_bubble.hoverVisible::after {
                                position: absolute;
                                top: 100%;
                                left: 50%;
                                transform: translate(-50%, -50%) rotate(45deg);
                                width: var(--gap);
                                height: var(--gap);
                                border-right: var(--line);
                                border-bottom: var(--line);
                                border-left: unset;
                                transform-origin: center;
                                z-index: 6;
                                background-color: var(--navBg);
                                transition: var(--tr);
                       }
                        .speech_bubble {
                                font-size: 1.5vh;
                                pointer-events: none;
                                position: absolute;
                                top: 0;
                                right: 0%;
                                line-height: 1;
                                padding: var(--gap);
                                border: var(--line);
                                border-radius: var(--rad);
                                transition:  var(--tr) ;
                                writing-mode: vertical-rl;
                                background: var(--navBg);
                        }
                        
                        /* テキスト枠左端中央の吹き出し */
                        .speech_bubble::after {
                                content: "";
                                position: absolute;
                                right: 100%;
                                top: 50%;
                                transform: translate(50%, -50%) rotate(45deg);
                                width: var(--gap);
                                height: var(--gap);
                                border-left: var(--line);
                                border-bottom: var(--line);
                                transform-origin: center;
                                z-index: 1;
                                background-color: var(--navBg);
                                transition: var(--tr);
                       }

                        /* .nav_window:hover+.model_container .speech_bubble {
                                opacity: 1;
                        } */

                        /* ドラッグ中のスタイル */
                        .nav_section.dragging {
                                transform: rotate(1deg);
                                box-shadow: 0 10px var(--inline) rgba(0, 0, 0, 0.3);
                        }

                        /* センターモード時のコンテンツ調整 */
                        .app_container.center .content_section {
                                display: inline-block;
                                width: calc(50% - var(--navW)/2);
                                vertical-align: top;
                        }

                        /* ローディング */
                        #loading {
                                position: absolute;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%);
                                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'Yu Gothic Medium', 'Meiryo', sans-serif;
                                padding: var(--gap);
                                border-radius: 10px;
                                z-index: 1000;
                        }

                        /* アニメーション制御 */
                        .model_controls {
                                position: absolute;
                                bottom: 10px;
                                left: 10px;
                                right: 10px;
                                display: none;
                                /* コントローラーを非表示 */
                                gap: 5px;
                                z-index: 20;
                        }

                        .model_control_btn {
                                flex: 1;
                                padding: 8px;
                                border: none;
                                border-radius: 4px;
                                cursor: pointer;
                                font-size: 10px;
                                transition: all var(--tr) ease;

                        }



                        /* レスポンシブ対応 */
                        @media (max-width: 768px) {
                                .app_container {
                                        grid-template-columns: 1fr !important;
                                        grid-template-rows: 1fr auto;
                                }

                                .nav_section {
                                        position: fixed;
                                        bottom: 0;
                                        left: 0;
                                        right: 0;
                                        height: 50vh;
                                        z-index: 1000;
                                        transform: translateY(100%);
                                        transition: transform var(--tr) ease;
                                        flex-direction: row;
                                }

                                .nav_section.open {
                                        transform: translateY(0);
                                }

                                .drag_area {
                                        display: none;
                                }

                                .mobile_toggle {
                                        display: block;
                                        position: fixed;
                                        bottom: var(--gap);
                                        right: var(--gap);
                                        z-index: 1001;
                                        padding: 15px;
                                        border: none;
                                        border-radius: 50%;
                                        background: var(--mc);
                                        cursor: pointer;
                                        box-shadow: var(--shadow);
                                }

                                .nav_window {
                                        flex: 0 0 60%;
                                        margin: 10px 0 10px 10px;
                                }

                                .model_container {
                                        flex: 0 0 40%;
                                        margin: 10px 10px 10px 0;
                                }

                                .content_section {
                                        width: 100% !important;
                                }
                        }
                </style>

                <!-- CDN Libraries -->
                <script src="https://unpkg.com/i18next@23.7.6/dist/umd/i18next.min.js"></script>
                <script src="https://unpkg.com/i18next-browser-languagedetector@7.2.0/dist/umd/i18nextBrowserLanguageDetector.min.js"></script>
                <script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
                
                <!-- Import Maps を使用してモジュール解決を設定 -->
                <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
        </head>

        <body>

                <div class="app_container left" id="appContainer">
                        <!-- ナビゲーションセクション -->
                        <aside class="nav_section" id="navSection">
                                <div class="drag_area" id="dragArea"></div>
                                <!-- ナビゲーションウインドウ -->
                                <div class="nav_window">
                                        <div class="nav_content">
                                                <div class="controls">
                                                        <button class="control_btn txwh" id="langToggle">EN / JP</button>
                                                        <button class="control_btn" id="themeToggle">🌙</button>
                                                </div>
                                                <nav class="navigation">
                                                        <a href="#home" data-i18n="nav.home">ホーム</a>
                                                        <a href="#about" data-i18n="nav.about">私について</a>
                                                        <a href="#portfolio" data-i18n="nav.portfolio">作品</a>
                                                        <a href="#skills" data-i18n="nav.skills">スキル</a>
                                                        <a href="#contact" data-i18n="nav.contact">お問い合わせ</a>
                                                </nav>
                                        </div>
                                </div>


                                <!-- 3Dモデルエリア -->
                                <div class="model_container">
                                        <canvas id="threeCanvas"></canvas>
                                        <div class="speech_bubble">このパネルはドラッグで移動できます</div>
                                        <div class="speech_bubble hoverVisible">Draggable!!</div>
                                        <div class="model_controls">
                                                <button class="model_control_btn"
                                                        onclick="toggleAnimation()">▶️/⏸️</button>
                                                <button class="model_control_btn" onclick="resetPose()">🔄</button>
                                                <button class="model_control_btn" onclick="raiseLeftArm()">👋</button>
                                        </div>
                                        <div id="loading">Loading 3D Model...</div>
                                </div>
                        </aside>

                        <!-- メインコンテンツ -->
                        <main class="main_content" id="mainContent">
                                <section class="content_section">
                                        <h1 data-i18n="content.welcome.title">Welcome to My Portfolio</h1>
                                        <p data-i18n="content.welcome.description">こんにちは！私のポートフォリオサイトへようこそ。このサイトは革新的なドラッグ可能なナビゲーションシステムを採用しており、右側のナビゲーションパネルを自由に移動させることができます。
                                        </p>
                                        <p data-i18n="content.welcome.lorem">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod
                                                tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim
                                                veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
                                                commodo consequat.</p>
                                </section>

                                <section class="content_section">
                                        <h2 data-i18n="content.about.title">About Me</h2>
                                        <p data-i18n="content.about.description">私はWebデザイナー兼開発者として、ユーザーエクスペリエンスを重視したインタラクティブなWebサイトの制作を行っています。Three.jsを活用した3D表現や、最新のCSS技術を駆使したアニメーションが得意分野です。
                                        </p>
                                        <p data-i18n="content.about.lorem">Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore
                                                eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
                                                proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                                        </p>
                                </section>

                                <section class="content_section">
                                        <h2 data-i18n="content.skills.title">Skills & Technologies</h2>
                                        <p data-i18n="content.skills.description">主要なスキルセット:</p>
                                        <ul style="margin-left: var(--gap); line-height: 1.8;">
                                                <li data-i18n="content.skills.list1">HTML5, CSS3, JavaScript (ES6+)</li>
                                                <li data-i18n="content.skills.list2">React, Vue.js, Node.js</li>
                                                <li data-i18n="content.skills.list3">Three.js, WebGL, Canvas API</li>
                                                <li data-i18n="content.skills.list4">CSS Grid, Flexbox, アニメーション</li>
                                                <li data-i18n="content.skills.list5">レスポンシブデザイン, PWA</li>
                                        </ul>
                                </section>

                                <section class="content_section">
                                        <h2 data-i18n="content.projects.title">Projects</h2>
                                        <p data-i18n="content.projects.description">これまでに手がけたプロジェクトの一部をご紹介します。各プロジェクトでは、ユーザビリティとデザイン性の両立を目指し、革新的なアプローチを採用しています。
                                        </p>
                                        <p data-i18n="content.projects.lorem">Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium
                                                doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo
                                                inventore veritatis et quasi architecto beatae vitae dicta sunt
                                                explicabo.</p>
                                </section>

                                <section class="content_section">
                                        <h2 data-i18n="content.contact.title">Contact</h2>
                                        <p data-i18n="content.contact.description">プロジェクトのご相談やお仕事のご依頼がございましたら、お気軽にお問い合わせください。新しい技術への挑戦や、クリエイティブなプロジェクトを特に歓迎いたします。
                                        </p>
                                        <p data-i18n="content.contact.lorem">Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit,
                                                sed quia consequuntur magni dolores eos qui ratione voluptatem sequi
                                                nesciunt.</p>
                                </section>
                        </main>


                </div>

                <!-- モバイル用トグルボタン -->
                <button class="mobile_toggle" id="mobileToggle" style="display: none;">☰</button>

                <script type="module">
                        import * as THREE from 'three';
                        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

                        // グローバル変数
                        let scene, camera, renderer, mixer, clock;
                        let isAnimationPlaying = true;
                        let currentActions = [];

                        // ポーズ制御用の変数
                        let armBones = {
                                leftShoulder: null,
                                leftArm: null,
                                leftForeArm: null,
                                rightShoulder: null,
                                rightArm: null,
                                rightForeArm: null
                        };

                        // ドラッグ&ドロップ機能
                        class DraggableNavigation {
                                constructor() {
                                        this.navSection = document.getElementById('navSection');
                                        this.container = document.getElementById('appContainer');
                                        this.dragArea = document.getElementById('dragArea');
                                        this.currentMode = 'left';
                                        this.isDragging = false;
                                        this.dragOffset = 0;

                                        this.initDragEvents();
                                        this.initMobileToggle();
                                }

                                initDragEvents() {
                                        this.dragArea.addEventListener('mousedown', this.startDrag.bind(this));
                                        this.dragArea.addEventListener('touchstart', this.startDrag.bind(this));
                                }

                                startDrag(e) {
                                        e.preventDefault();
                                        this.isDragging = true;
                                        this.navSection.classList.add('dragging');

                                        const startX = e.clientX || e.touches[0].clientX;
                                        const containerRect = this.container.getBoundingClientRect();
                                        const navRect = this.navSection.getBoundingClientRect();
                                        
                                        // ドラッグ開始時のオフセットを計算
                                        this.dragOffset = startX - navRect.left;

                                        const handleMove = (e) => {
                                                if (!this.isDragging) return;

                                                const currentX = e.clientX || e.touches[0].clientX;
                                                const containerWidth = containerRect.width;
                                                const navWidth = navRect.width;
                                                
                                                // カーソルに追従する位置を計算
                                                const targetX = currentX - this.dragOffset;
                                                const clampedX = Math.max(0, Math.min(targetX, containerWidth - navWidth));
                                                
                                                // リアルタイムで位置を更新
                                                this.navSection.style.left = `${clampedX}px`;
                                                
                                                // 位置判定（スナップ用）
                                                const relativeX = currentX / containerWidth;
                                                let targetMode;
                                                
                                                if (relativeX < 0.25) {
                                                        targetMode = 'left';
                                                } else if (relativeX > 0.75) {
                                                        targetMode = 'right';
                                                } else {
                                                        targetMode = 'center';
                                                }
                                                
                                                // モードが変わった場合のみ更新（パフォーマンス向上）
                                                if (targetMode !== this.currentMode) {
                                                        // ドラッグ中はレイアウトクラスのみ更新（スタイル属性は保持）
                                                        this.container.className = `app_container ${targetMode}`;
                                                        this.currentMode = targetMode;
                                                }
                                        };

                                        const handleEnd = () => {
                                                if (!this.isDragging) return;
                                                
                                                this.isDragging = false;
                                                this.navSection.classList.remove('dragging');
                                                
                                                // 最終的な位置にスナップ
                                                const containerRect = this.container.getBoundingClientRect();
                                                const navRect = this.navSection.getBoundingClientRect();
                                                const relativeX = (navRect.left + navRect.width / 2) / containerRect.width;
                                                
                                                let finalMode;
                                                if (relativeX < 0.33) {
                                                        finalMode = 'left';
                                                } else if (relativeX > 0.67) {
                                                        finalMode = 'right';
                                                } else {
                                                        finalMode = 'center';
                                                }
                                                
                                                this.setMode(finalMode, true); // スナップありで最終更新
                                                
                                                // ドロップ時にスタイル属性を確実に解除
                                                this.navSection.style.left = '';
                                                
                                                document.removeEventListener('mousemove', handleMove);
                                                document.removeEventListener('mouseup', handleEnd);
                                                document.removeEventListener('touchmove', handleMove);
                                                document.removeEventListener('touchend', handleEnd);
                                        };

                                        document.addEventListener('mousemove', handleMove);
                                        document.addEventListener('mouseup', handleEnd);
                                        document.addEventListener('touchmove', handleMove);
                                        document.addEventListener('touchend', handleEnd);
                                }

                                setMode(mode, snap = true) {
                                        if (this.currentMode === mode && snap) return;

                                        this.container.className = `app_container ${mode}`;
                                        this.currentMode = mode;

                                        // ドロップ時は常にスタイル属性を解除
                                        if (snap) {
                                                this.navSection.style.left = '';
                                        }

                                        // Three.jsキャンバスのリサイズ
                                        setTimeout(() => {
                                                if (window.resizeThreeJS) {
                                                        window.resizeThreeJS();
                                                }
                                        }, snap ? 300 : 0);

                                        console.log('Layout mode changed to:', mode, snap ? '(snapped)' : '(dragging)');
                                }

                                initMobileToggle() {
                                        const mobileToggle = document.getElementById('mobileToggle');
                                        const isMobile = window.innerWidth <= 768;

                                        if (isMobile) {
                                                mobileToggle.style.display = 'block';
                                                mobileToggle.addEventListener('click', () => {
                                                        this.navSection.classList.toggle('open');
                                                });
                                        }
                                }
                        }

                        // Three.js初期化
                        function initThreeJS() {
                                const canvas = document.getElementById('threeCanvas');
                                const container = document.querySelector('.model_container');

                                // シーン作成
                                scene = new THREE.Scene();

                                // カメラ作成
                                camera = new THREE.PerspectiveCamera(50, container.offsetWidth / container.offsetHeight, 0.1, 1000);
                                camera.position.set(0, 1, 3);

                                // レンダラー作成
                                renderer = new THREE.WebGLRenderer({
                                        canvas: canvas,
                                        antialias: true,
                                        alpha: true
                                });
                                renderer.setSize(container.offsetWidth, container.offsetHeight);
                                renderer.setClearColor(0x000000, 0);
                                renderer.toneMapping = THREE.ACESFilmicToneMapping;
                                renderer.toneMappingExposure = 1.5;
                                renderer.outputColorSpace = THREE.SRGBColorSpace;

                                // 照明設定
                                const ambientLight = new THREE.AmbientLight(0xffffff, 2.0);
                                scene.add(ambientLight);

                                // アニメーション用Clock
                                clock = new THREE.Clock();

                                // モデル読み込み
                                loadModel();

                                // リサイズ関数をグローバルに設定
                                window.resizeThreeJS = function () {
                                        const rect = container.getBoundingClientRect();
                                        camera.aspect = rect.width / rect.height;
                                        camera.updateProjectionMatrix();
                                        renderer.setSize(rect.width, rect.height);
                                };

                                // ウィンドウリサイズイベント
                                window.addEventListener('resize', window.resizeThreeJS);

                                // アニメーションループ開始
                                animate();
                        }

                        function loadModel() {
                                const loader = new GLTFLoader();

                                loader.load('./model.glb', function (gltf) {
                                        console.log('GLTF loaded successfully:', gltf);
                                        const model = gltf.scene;

                                        // 元の材質を保存
                                        window.originalMaterials = new Map();

                                        model.traverse(function (child) {
                                                if (child.isMesh) {
                                                        window.originalMaterials.set(child, child.material.clone());

                                                        if (child.material.isMeshStandardMaterial) {
                                                                child.material.roughness = 1.0;
                                                                child.material.metalness = 0.0;
                                                        }
                                                }
                                        });

                                        scene.add(model);
                                        window.currentModel = model;

                                        // 腕のボーン情報を設定
                                        setupArmBones(model);

                                        // アニメーション設定
                                        if (gltf.animations && gltf.animations.length > 0) {
                                                mixer = new THREE.AnimationMixer(model);
                                                currentActions = [];

                                                gltf.animations.forEach((clip) => {
                                                        const action = mixer.clipAction(clip);
                                                        action.play();
                                                        currentActions.push(action);
                                                });
                                        }

                                        model.position.set(0, 0, 0);
                                        model.scale.set(1, 1, 1);

                                        // ローディング表示を非表示
                                        document.getElementById('loading').style.display = 'none';

                                }, function (progress) {
                                        if (progress.total > 0) {
                                                const percent = Math.round((progress.loaded / progress.total * 100));
                                                document.getElementById('loading').innerHTML = `Loading model... ${percent}%`;
                                        }
                                }, function (error) {
                                        console.error("モデル読み込みエラー:", error);
                                        document.getElementById('loading').innerHTML = 'Error loading model: ' + error.message;
                                });
                        }

                        function setupArmBones(model) {
                                model.traverse(function (child) {
                                        if (child.isBone) {
                                                const name = child.name.toLowerCase();
                                                if (name.includes('leftshoulder')) {
                                                        armBones.leftShoulder = child;
                                                } else if (name.includes('leftarm') && !name.includes('forearm')) {
                                                        armBones.leftArm = child;
                                                } else if (name.includes('leftforearm')) {
                                                        armBones.leftForeArm = child;
                                                } else if (name.includes('rightshoulder')) {
                                                        armBones.rightShoulder = child;
                                                } else if (name.includes('rightarm') && !name.includes('forearm')) {
                                                        armBones.rightArm = child;
                                                } else if (name.includes('rightforearm')) {
                                                        armBones.rightForeArm = child;
                                                }
                                        }
                                });
                        }

                        function animate() {
                                requestAnimationFrame(animate);
                                const delta = clock.getDelta();
                                if (mixer) mixer.update(delta);
                                renderer.render(scene, camera);
                        }

                        // ポーズ制御関数
                        window.toggleAnimation = function () {
                                isAnimationPlaying = !isAnimationPlaying;

                                if (currentActions.length > 0) {
                                        currentActions.forEach(action => {
                                                if (isAnimationPlaying) {
                                                        action.play();
                                                } else {
                                                        action.stop();
                                                }
                                        });
                                }
                        }

                        window.resetPose = function () {
                                Object.values(armBones).forEach(bone => {
                                        if (bone) {
                                                bone.rotation.set(0, 0, 0);
                                        }
                                });
                        }

                        window.raiseLeftArm = function () {
                                if (armBones.leftShoulder) {
                                        armBones.leftShoulder.rotation.x = -Math.PI / 2;
                                }
                        }

                        // 多言語設定
                        const initI18n = () => {
                                i18next.init({
                                        lng: 'ja',
                                        fallbackLng: 'en',
                                        resources: {
                                                ja: {
                                                        translation: {
                                                                'nav.home': 'ホーム',
                                                                'nav.about': '私について',
                                                                'nav.portfolio': '作品',
                                                                'nav.skills': 'スキル',
                                                                'nav.contact': 'お問い合わせ',
                                                                'content.welcome.title': 'Welcome to My Portfolio',
                                                                'content.welcome.description': 'こんにちは！私のポートフォリオサイトへようこそ。このサイトは革新的なドラッグ可能なナビゲーションシステムを採用しており、右側のナビゲーションパネルを自由に移動させることができます。',
                                                                'content.welcome.lorem': 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.',
                                                                'content.about.title': 'About Me',
                                                                'content.about.description': '私はWebデザイナー兼開発者として、ユーザーエクスペリエンスを重視したインタラクティブなWebサイトの制作を行っています。Three.jsを活用した3D表現や、最新のCSS技術を駆使したアニメーションが得意分野です。',
                                                                'content.about.lorem': 'Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.',
                                                                'content.skills.title': 'Skills & Technologies',
                                                                'content.skills.description': '主要なスキルセット:',
                                                                'content.skills.list1': 'HTML5, CSS3, JavaScript (ES6+)',
                                                                'content.skills.list2': 'React, Vue.js, Node.js',
                                                                'content.skills.list3': 'Three.js, WebGL, Canvas API',
                                                                'content.skills.list4': 'CSS Grid, Flexbox, アニメーション',
                                                                'content.skills.list5': 'レスポンシブデザイン, PWA',
                                                                'content.projects.title': 'Projects',
                                                                'content.projects.description': 'これまでに手がけたプロジェクトの一部をご紹介します。各プロジェクトでは、ユーザビリティとデザイン性の両立を目指し、革新的なアプローチを採用しています。',
                                                                'content.projects.lorem': 'Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.',
                                                                'content.contact.title': 'Contact',
                                                                'content.contact.description': 'プロジェクトのご相談やお仕事のご依頼がございましたら、お気軽にお問い合わせください。新しい技術への挑戦や、クリエイティブなプロジェクトを特に歓迎いたします。',
                                                                'content.contact.lorem': 'Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.'
                                                        }
                                                },
                                                en: {
                                                        translation: {
                                                                'nav.home': 'Home',
                                                                'nav.about': 'About',
                                                                'nav.portfolio': 'Portfolio',
                                                                'nav.skills': 'Skills',
                                                                'nav.contact': 'Contact',
                                                                'content.welcome.title': 'Welcome to My Portfolio',
                                                                'content.welcome.description': 'Welcome to my portfolio site! This site features an innovative draggable navigation system that allows you to freely move the navigation panel on the right side.',
                                                                'content.welcome.lorem': 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.',
                                                                'content.about.title': 'About Me',
                                                                'content.about.description': 'As a web designer and developer, I create interactive websites that prioritize user experience. I specialize in 3D expressions using Three.js and animations using the latest CSS technologies.',
                                                                'content.about.lorem': 'Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.',
                                                                'content.skills.title': 'Skills & Technologies',
                                                                'content.skills.description': 'Main skill set:',
                                                                'content.skills.list1': 'HTML5, CSS3, JavaScript (ES6+)',
                                                                'content.skills.list2': 'React, Vue.js, Node.js',
                                                                'content.skills.list3': 'Three.js, WebGL, Canvas API',
                                                                'content.skills.list4': 'CSS Grid, Flexbox, Animations',
                                                                'content.skills.list5': 'Responsive Design, PWA',
                                                                'content.projects.title': 'Projects',
                                                                'content.projects.description': 'Here are some of the projects I have worked on. Each project aims to balance usability and design, adopting innovative approaches.',
                                                                'content.projects.lorem': 'Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.',
                                                                'content.contact.title': 'Contact',
                                                                'content.contact.description': 'If you have any project consultations or work requests, please feel free to contact me. I particularly welcome challenges with new technologies and creative projects.',
                                                                'content.contact.lorem': 'Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.'
                                                        }
                                                }
                                        }
                                });
                        };

                        // ダークモード設定
                        const initDarkMode = () => {
                                // ローカルストレージからテーマ設定を読み込み
                                const savedTheme = localStorage.getItem('theme');
                                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                                const isDark = savedTheme === 'dark' || (!savedTheme && prefersDark);
                                
                                // 初期テーマを適用
                                if (isDark) {
                                        document.documentElement.setAttribute('data-theme', 'dark');
                                        document.getElementById('themeToggle').textContent = '☀️';
                                } else {
                                        document.documentElement.removeAttribute('data-theme');
                                        document.getElementById('themeToggle').textContent = '🌙';
                                }
                                
                                // ダークモードボタンに機能を追加
                                document.getElementById('themeToggle').addEventListener('click', function() {
                                        const isCurrentlyDark = document.documentElement.hasAttribute('data-theme');
                                        
                                        if (isCurrentlyDark) {
                                                // ライトモードに切り替え
                                                document.documentElement.removeAttribute('data-theme');
                                                localStorage.setItem('theme', 'light');
                                                this.textContent = '🌙';
                                        } else {
                                                // ダークモードに切り替え
                                                document.documentElement.setAttribute('data-theme', 'dark');
                                                localStorage.setItem('theme', 'dark');
                                                this.textContent = '☀️';
                                        }
                                });
                                
                                // OSのテーマ変更を監視
                                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                                        if (!localStorage.getItem('theme')) {
                                                if (e.matches) {
                                                        document.documentElement.setAttribute('data-theme', 'dark');
                                                        document.getElementById('themeToggle').textContent = '☀️';
                                                } else {
                                                        document.documentElement.removeAttribute('data-theme');
                                                        document.getElementById('themeToggle').textContent = '🌙';
                                                }
                                        }
                                });
                        };

                        // 言語切り替え機能
                        const initLanguageToggle = () => {
                                document.getElementById('langToggle').addEventListener('click', function() {
                                        const currentLang = i18next.language;
                                        const newLang = currentLang === 'ja' ? 'en' : 'ja';
                                        
                                        i18next.changeLanguage(newLang).then(() => {
                                                // ページ全体の翻訳を更新
                                                document.querySelectorAll('[data-i18n]').forEach(element => {
                                                        const key = element.getAttribute('data-i18n');
                                                        element.textContent = i18next.t(key);
                                                });
                                                
                                                // lang属性を設定
                                                document.documentElement.setAttribute('lang', newLang);
                                                
                                                // ボタンテキストを更新
                                                this.textContent = newLang === 'ja' ? 'EN/JP' : 'JP/EN';
                                        });
                                });
                        };

                        // 初期化
                        document.addEventListener('DOMContentLoaded', function () {
                                // 多言語設定
                                initI18n();
                                
                                // ダークモード設定
                                initDarkMode();
                                
                                // 言語切り替え設定
                                initLanguageToggle();

                                // ドラッグ機能初期化
                                new DraggableNavigation();

                                // Three.js初期化
                                initThreeJS();

                                // 初期翻訳を適用
                                setTimeout(() => {
                                        // 初期言語を設定
                                        document.documentElement.setAttribute('lang', i18next.language);
                                        
                                        document.querySelectorAll('[data-i18n]').forEach(element => {
                                                const key = element.getAttribute('data-i18n');
                                                element.textContent = i18next.t(key);
                                        });
                                }, 100);
                        });
                </script>
        </body>

</html>